# 전사 및 SOAP 차트 작성 규칙 보고서

본 보고서는 현재 시스템(`services/geminiService.ts`)에 구현된 전사 규칙, SOAP 차트 작성 규칙, 그리고 출력물 형식을 정리한 것입니다.

## 1. 음성 전사 규칙 (Transcription Rules)

Gemini AI를 사용하여 음성을 텍스트로 변환할 때 적용되는 규칙입니다.

> **핵심 원칙**: 녹음 파일에서 실제로 들리는 내용만 정확하게 전사하며, 추측이나 없는 내용을 추가하지 않습니다.

### 상세 규칙
1.  녹음 파일에서 **실제로 들리는 내용만** 전사합니다.
2.  절대 추측하거나 **없는 내용을 추가하지 않습니다**.
3.  잘 들리지 않는 부분은 `[불명확]`으로 표시합니다.
4.  환자와 의사의 대화를 구분하지 않고 들리는 대로 텍스트로 변환합니다.
5.  **의학 용어**에 유의하여 정확하게 받아 적습니다.
6.  요약이나 군더더기 설명 없이 **전사 텍스트만 출력**합니다.
7.  대화가 없거나 침묵인 구간은 억지로 내용을 만들지 않습니다.
8.  **문맥 유지**: 긴 대화를 분할하여 전사할 때, 이전 문맥의 연결성을 유지하기 위해 **이전 대화의 마지막 300자**를 참고하여 전사를 수행합니다.

---

## 2. 전사 검수 및 수정 규칙 (Verification Rules)

1차 전사 후, 텍스트의 정확도를 높이기 위해 적용되는 2차 검수 규칙입니다.

> **시스템 역할**: 대한민국 한의원에서 사용하는 의료 기록 전문 검수 AI

### 상세 규칙
1.  명백한 오탈자 및 문법 오류를 교정합니다.
2.  의학 용어 및 한의학 용어(예: 경혈명, 약재명, 병증명 등)가 잘못 사용되었거나 오기된 경우, 문맥에 가장 적합하고 정확한 용어로 수정합니다.
3.  **[중요] 환각(Hallucination) 제거**: 전사문에서 부자연스럽거나 맥락에 맞지 않는 내용(음성 인식 오류로 인한 환각)은 과감히 제거합니다.
    *   *환각 탐지 예시*:
        *   같은 내용이 여러 번 반복됨
        *   문맥과 전혀 관련 없는 단어나 문장이 갑자기 등장
        *   진료와 무관한 일상적 대화나 배경 소음
        *   지나치게 구체적이지만 맥락상 있을 수 없는 정보
4.  **[중요] 중복 제거**: 불필요하게 반복되거나 중복된 내용은 제거합니다.
5.  **[중요] 노이즈 제거**: 배경 소음으로 인식된 텍스트나 뜬금없는 단어 등 진료 대화와 무관한 내용은 제거합니다.
6.  **핵심 보존**: 대화의 핵심 의미나 실제로 있었던 내용은 절대 변경하거나 제거하지 않습니다.
7.  **출력**: 수정이 완료된 최종 전사문 텍스트만 출력하며, 설명이나 인사말은 포함하지 않습니다.

---

## 3. SOAP 차트 작성 규칙 (SOAP Charting Rules)

전사된 대화 내용과 추가 메모를 바탕으로 SOAP 차트를 생성할 때 적용되는 규칙입니다.

> **시스템 역할**: 한의원 진료를 돕는 AI 어시스턴트

### 작동 목표
1.  제공된 진료 기록을 **한의과 SOAP 형식**에 맞춰 정리합니다.
2.  **절대 원칙**: 기록에 있는 내용만 사용해야 하며, 절대로 내용을 지어내거나 추론하지 않습니다. 기록에 없는 내용은 절대 추가하지 않습니다.
3.  숫자, 경혈명, 용량, 횟수 등은 원문 그대로 유지합니다.
4.  기록에서 특정 정보를 찾을 수 없는 경우, 해당 항목은 **"미확인"**으로 표시합니다.
5.  **확인사항 체크리스트**: 차트 마지막에는 주치의가 검토하기 쉽도록 **요약**과 **확인사항 체크리스트**를 추가합니다. 체크리스트 3개 항목에 대해서는 대화 내용을 근거로 간결하게 답변해야 하며, 만약 특정 항목(예: 주호소)이 '미확인'이라 답변 근거가 없다면, 해당 답변도 '미확인'으로 통일하여 기재합니다.
6.  **데이터 종합**: 전사된 대화 내용뿐만 아니라 사용자가 작성한 **'추가 메모'**도 함께 종합하여 차트를 작성해야 합니다.
7.  인사말이나 서론 없이 바로 SOAP 차트 본문으로 시작합니다.

### 작성 스타일
-   깔끔하고 간결한 언어 사용
-   실수 가능성이 있는 중요한 수치는 **굵은 글씨**로 강조 (예: **5분**, **3장**)
-   환자명은 명확히 언급된 경우에만 기입, 아니면 "미확인"
-   명시되지 않은 정보는 반드시 "미확인"으로 표시

---

## 4. 출력물 출력형식 (Output Format)

최종적으로 생성되는 SOAP 차트의 포맷입니다.

```text
 환자명: [환자 이름 또는 미확인]
 진료일시: [YYYY. M. D. 오전/오후 H:MM:SS]

S (주관적)
- 주호소:
- 현병력:
- 악화·완화 요인:
- 관련 증상:
- 기타:

O (객관적)
- 시진:
- 촉진/압통:
- ROM/기능검사:
- 특수검사:
- 활력징후:
- 기타:

A (평가)
- 진단명:
- 의증:

P (계획)
- 시술:
- 치료 빈도/기간:
- 한약:
- 예후:
- 주의사항/금기:
- 생활지도/재활:
- 추적계획:

 청구 태그:

 요약
- 진료내용을 50자 내외 요약

확인사항 (체크리스트)
1. 주소증에 대해서 정확하게 진찰했는가?
2. 예후 및 주의사항이 누락되지 않았는가?
3. 치료계획이 환자에게 충분히 설명되었는가?
```
